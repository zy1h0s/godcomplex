<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Settings</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      cursor: default !important;
    }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      color: #fff;
      -webkit-app-region: drag;
    }

    .settings-container {
      background: rgba(0, 0, 0, 0.98);
      border: 2px solid #ffffff;
      width: 420px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .titlebar {
      background: #ffffff;
      color: #000000;
      padding: 12px 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      -webkit-app-region: drag;
      border-bottom: 2px solid #ffffff;
    }

    .titlebar h1 {
      font-size: 12px;
      font-weight: 700;
      letter-spacing: 2px;
      margin: 0;
    }

    .close-btn {
      background: #000000;
      color: #ffffff;
      border: none;
      width: 22px;
      height: 22px;
      font-size: 18px;
      line-height: 1;
      -webkit-app-region: no-drag;
      transition: background 0.2s;
    }

    .close-btn:hover {
      background: #ff0000;
    }

    .content {
      padding: 20px;
      -webkit-app-region: no-drag;
    }

    h2 {
      margin: 15px 0 10px;
      font-size: 11px;
      color: #ffffff;
      letter-spacing: 2px;
      text-transform: uppercase;
      font-weight: 700;
      border-bottom: 1px solid #ffffff;
      padding-bottom: 5px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-size: 9px;
      color: #ffffff;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 600;
    }

    input[type="number"],
    input[type="text"],
    select {
      width: 100%;
      padding: 8px;
      border: 1px solid #ffffff;
      background: transparent;
      color: #ffffff;
      font-size: 11px;
      outline: none;
    }

    input[type="color"] {
      width: 100%;
      height: 35px;
      border: 1px solid #ffffff;
      background: transparent;
    }

    select {
    }

    option {
      background: #000000;
      color: #ffffff;
    }

    input[type="range"] {
      width: 100%;
      margin-top: 5px;
      -webkit-appearance: none;
      background: transparent;
    }

    input[type="range"]::-webkit-slider-track {
      background: #ffffff;
      height: 2px;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 14px;
      height: 14px;
      background: #ffffff;
      border: 2px solid #000000;
    }

    .range-value {
      display: inline-block;
      margin-left: 10px;
      font-weight: 700;
      color: #ffffff;
      font-size: 10px;
    }

    .btn-container {
      display: flex;
      gap: 8px;
      margin-top: 20px;
    }

    .btn {
      flex: 1;
      padding: 10px;
      border: 2px solid #ffffff;
      font-size: 9px;
      font-weight: 700;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .btn:hover {
      opacity: 0.9;
    }

    .btn-primary {
      background: #ffffff;
      color: #000000;
    }

    .btn-primary:hover {
      background: #000000;
      color: #ffffff;
    }

    .btn-secondary {
      background: transparent;
      color: #ffffff;
    }

    .btn-secondary:hover {
      background: #ffffff;
      color: #000000;
    }

    .btn-danger {
      background: #ff0000;
      color: #ffffff;
      border-color: #ff0000;
    }

    .btn-danger:hover {
      background: transparent;
      color: #ff0000;
    }

    .info {
      background: transparent;
      padding: 12px;
      border: 1px solid #ffffff;
      margin-top: 15px;
      font-size: 9px;
      color: #ffffff;
      line-height: 1.6;
    }

    .info strong {
      color: #ffffff;
      font-weight: 700;
    }

    .hidden {
      display: none;
    }

    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: #000000;
    }

    ::-webkit-scrollbar-thumb {
      background: #ffffff;
    }
  </style>
</head>
<body>
  <div class="settings-container">
    <div class="titlebar">
      <h1 id="windowTitle">TEXT SETTINGS</h1>
      <button class="close-btn" onclick="window.close()">Ã—</button>
    </div>

    <div class="content">
      <!-- Text Window Settings -->
      <div id="textSettings" class="hidden">
        <h2>Text Window</h2>

        <div class="form-group">
          <label>Font Size: <span class="range-value" id="fontSizeValue">16px</span></label>
          <input type="range" id="fontSize" min="10" max="48" value="16" oninput="updateValue('fontSize', 'px')">
        </div>

        <div class="form-group">
          <label>Font Family:</label>
          <select id="fontFamily">
            <option value="Arial">Arial</option>
            <option value="Helvetica">Helvetica</option>
            <option value="Times New Roman">Times New Roman</option>
            <option value="Courier New">Courier New</option>
            <option value="Georgia">Georgia</option>
            <option value="Verdana">Verdana</option>
            <option value="Comic Sans MS">Comic Sans MS</option>
          </select>
        </div>

        <div class="form-group">
          <label>Background Opacity: <span class="range-value" id="bgOpacityValue">30%</span></label>
          <input type="range" id="bgOpacity" min="0" max="100" value="30" oninput="updateValue('bgOpacity', '%')">
        </div>

        <div class="info">
          <p><strong>Theme Toggle:</strong> Use the â˜€/ðŸŒ™ button in the text window to switch between dark (black bg/white text) and light (white bg/black text) modes.</p>
        </div>
      </div>

      <!-- Code Window Settings -->
      <div id="codeSettings" class="hidden">
        <h2>Code Window</h2>

        <div class="form-group">
          <label>Font Size: <span class="range-value" id="codeFontSizeValue">14px</span></label>
          <input type="range" id="codeFontSize" min="10" max="24" value="14" oninput="updateValue('codeFontSize', 'px')">
        </div>

        <div class="form-group">
          <label>Background Opacity: <span class="range-value" id="codeBgOpacityValue">95%</span></label>
          <input type="range" id="codeBgOpacity" min="0" max="100" value="95" oninput="updateValue('codeBgOpacity', '%')">
        </div>
      </div>

      <!-- Image Window Settings -->
      <div id="imageSettings" class="hidden">
        <h2>Image Window</h2>

        <div class="form-group">
          <label>Background Opacity: <span class="range-value" id="imageBgOpacityValue">30%</span></label>
          <input type="range" id="imageBgOpacity" min="0" max="100" value="30" oninput="updateValue('imageBgOpacity', '%')">
        </div>
      </div>

      <div class="info">
        <p><strong>Ctrl+Shift+T</strong> - Toggle click-through</p>
        <p><strong>Ctrl+Shift+S</strong> - Open settings</p>
      </div>

      <div class="btn-container">
        <button class="btn btn-primary" onclick="saveSettings()">Save</button>
        <button class="btn btn-secondary" onclick="resetSettings()">Reset</button>
      </div>

      <div class="btn-container">
        <button class="btn btn-danger" onclick="logout()">Logout</button>
      </div>
    </div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    let currentSettings = null;
    let currentWindowType = 'text';

    // Load current settings
    window.addEventListener('DOMContentLoaded', () => {
      currentSettings = ipcRenderer.sendSync('get-settings');
      loadSettings(currentSettings);
    });

    // Listen for window type updates
    ipcRenderer.on('set-window-type', (event, windowType) => {
      currentWindowType = windowType;
      showSettingsForWindow(windowType);
    });

    function showSettingsForWindow(windowType) {
      // Hide all settings
      document.getElementById('textSettings').classList.add('hidden');
      document.getElementById('codeSettings').classList.add('hidden');
      document.getElementById('imageSettings').classList.add('hidden');

      // Show relevant settings and update title
      if (windowType === 'text') {
        document.getElementById('textSettings').classList.remove('hidden');
        document.getElementById('windowTitle').textContent = 'TEXT SETTINGS';
      } else if (windowType === 'code') {
        document.getElementById('codeSettings').classList.remove('hidden');
        document.getElementById('windowTitle').textContent = 'CODE SETTINGS';
      } else if (windowType === 'image') {
        document.getElementById('imageSettings').classList.remove('hidden');
        document.getElementById('windowTitle').textContent = 'IMAGE SETTINGS';
      }
    }

    function loadSettings(settings) {
      // Text window settings
      if (settings.textWindow) {
        document.getElementById('fontSize').value = settings.textWindow.fontSize || 16;
        document.getElementById('fontFamily').value = settings.textWindow.fontFamily || 'Arial';
        document.getElementById('bgOpacity').value = (settings.textWindow.bgOpacity || 0.3) * 100;
        updateValue('fontSize', 'px');
        updateValue('bgOpacity', '%');
      }

      // Code window settings
      if (settings.codeWindow) {
        document.getElementById('codeFontSize').value = settings.codeWindow.fontSize || 14;
        document.getElementById('codeBgOpacity').value = (settings.codeWindow.bgOpacity || 0.95) * 100;
        updateValue('codeFontSize', 'px');
        updateValue('codeBgOpacity', '%');
      }

      // Image window settings
      if (settings.imageWindow) {
        document.getElementById('imageBgOpacity').value = (settings.imageWindow.bgOpacity || 0.3) * 100;
        updateValue('imageBgOpacity', '%');
      }
    }

    function updateValue(id, unit) {
      const value = document.getElementById(id).value;
      const display = document.getElementById(id + 'Value');
      if (display) {
        display.textContent = value + unit;
      }
    }

    function saveSettings() {
      const newSettings = {};

      if (currentWindowType === 'text') {
        newSettings.textWindow = {
          fontSize: parseInt(document.getElementById('fontSize').value),
          fontFamily: document.getElementById('fontFamily').value,
          bgOpacity: parseInt(document.getElementById('bgOpacity').value) / 100
        };
      } else if (currentWindowType === 'code') {
        newSettings.codeWindow = {
          fontSize: parseInt(document.getElementById('codeFontSize').value),
          bgOpacity: parseInt(document.getElementById('codeBgOpacity').value) / 100
        };
      } else if (currentWindowType === 'image') {
        newSettings.imageWindow = {
          bgOpacity: parseInt(document.getElementById('imageBgOpacity').value) / 100
        };
      }

      ipcRenderer.send('update-settings', newSettings);

      // Visual feedback
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = 'âœ“ Saved!';
      setTimeout(() => {
        btn.textContent = originalText;
      }, 1500);
    }

    function resetSettings() {
      if (confirm('Reset settings to default for this window?')) {
        const defaultSettings = {
          textWindow: {
            fontSize: 16,
            fontFamily: 'Arial',
            bgOpacity: 0.3
          },
          codeWindow: {
            fontSize: 14,
            bgOpacity: 0.95
          },
          imageWindow: {
            bgOpacity: 0.3
          }
        };

        loadSettings(defaultSettings);

        // Save only the current window's settings
        const newSettings = {};
        if (currentWindowType === 'text') {
          newSettings.textWindow = defaultSettings.textWindow;
        } else if (currentWindowType === 'code') {
          newSettings.codeWindow = defaultSettings.codeWindow;
        } else if (currentWindowType === 'image') {
          newSettings.imageWindow = defaultSettings.imageWindow;
        }

        ipcRenderer.send('update-settings', newSettings);
      }
    }

    function logout() {
      if (confirm('Are you sure you want to logout?')) {
        ipcRenderer.send('logout');
        window.close();
      }
    }
  </script>
</body>
</html>
