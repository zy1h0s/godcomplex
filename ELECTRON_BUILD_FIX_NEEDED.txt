================================================================================
ELECTRON BUILD NETWORK ISSUE - WHAT'S WRONG & HOW TO FIX
================================================================================

PROBLEM SUMMARY:
---------------
Your Electron app can't login/register in the built version because it's
hardcoded to connect to "http://localhost:3001" which doesn't exist on
user's machines. It works in development because your backend IS running
on localhost during development.

================================================================================
CRITICAL ISSUES FOUND:
================================================================================

1. HARDCODED LOCALHOST URLs (MAIN PROBLEM)
-------------------------------------------

File: electron-app/login.html (Line 242)
Current code:
  const API_URL = process.env.API_URL || 'http://localhost:3001';

Problem: process.env doesn't work in Electron renderer processes, so it
always uses localhost:3001. In production, there's no backend on localhost!


File: electron-app/text-overlay.html (Line 146)
Current code:
  const WS_URL = process.env.WS_URL || 'http://localhost:3001';

Same problem - hardcoded localhost WebSocket URL.


File: electron-app/image-overlay.html (Line 133)
Current code:
  const WS_URL = process.env.WS_URL || 'http://localhost:3001';

Same problem - hardcoded localhost WebSocket URL.


File: electron-app/code-overlay.html (Line 166)
Current code:
  const WS_URL = 'http://localhost:3001';

WORST CASE - No environment variable at all, purely hardcoded!


2. CONTENT SECURITY POLICY BLOCKS PRODUCTION URLs
--------------------------------------------------

File: electron-app/code-overlay.html (Line 5)
Current CSP:
  connect-src http://localhost:3001 ws://localhost:3001

Problem: This CSP explicitly ONLY allows connections to localhost:3001.
Even if you fix the URLs, this CSP will block production backend URLs.


3. MISSING PRODUCTION BACKEND URL
----------------------------------

You need to know: What is your ACTUAL production backend URL?
- Is it hosted on Render, Heroku, Railway, etc.?
- What's the URL? (e.g., https://yourapp.onrender.com)

================================================================================
HOW TO FIX - CHOOSE ONE APPROACH:
================================================================================

OPTION A: SIMPLE CONFIG FILE (RECOMMENDED FOR YOU)
---------------------------------------------------

Step 1: Create electron-app/config.js
---------------------------------------
window.APP_CONFIG = {
  API_URL: 'https://YOUR-ACTUAL-BACKEND-URL.com',  // <-- PUT YOUR BACKEND URL HERE
  WS_URL: 'https://YOUR-ACTUAL-BACKEND-URL.com'     // <-- PUT YOUR BACKEND URL HERE
};


Step 2: Load config in HTML files
----------------------------------
In ALL these files, add BEFORE any other scripts:
  - electron-app/login.html
  - electron-app/text-overlay.html
  - electron-app/code-overlay.html
  - electron-app/image-overlay.html

Add this line:
  <script src="config.js"></script>

Then change their URL declarations to:
  const API_URL = window.APP_CONFIG.API_URL;
  const WS_URL = window.APP_CONFIG.WS_URL;


Step 3: Fix the CSP in code-overlay.html (Line 5)
--------------------------------------------------
Change the connect-src part to allow your production URL:

Old:
  connect-src http://localhost:3001 ws://localhost:3001

New:
  connect-src http://localhost:3001 ws://localhost:3001 https://YOUR-BACKEND-URL.com wss://YOUR-BACKEND-URL.com


Step 4: Update package.json build config (if needed)
-----------------------------------------------------
Make sure electron-app/config.js is included in your build.
In package.json, under electron-builder config, ensure "files" includes:
  "files": [
    "**/*",
    "config.js"
  ]

================================================================================

OPTION B: ENVIRONMENT VARIABLES (MORE COMPLEX)
-----------------------------------------------

This requires:
1. Creating a proper preload script
2. Modifying main.js to expose config via IPC
3. Setting environment variables before building
4. More code changes across multiple files

If you want this approach, let me know and I'll provide detailed steps.

================================================================================
SPECIFIC EDITS NEEDED (FOR OPTION A):
================================================================================

FILE 1: electron-app/config.js (NEW FILE - CREATE THIS)
--------------------------------------------------------
window.APP_CONFIG = {
  API_URL: 'https://YOUR-BACKEND-URL-HERE.com',
  WS_URL: 'https://YOUR-BACKEND-URL-HERE.com'
};


FILE 2: electron-app/login.html
--------------------------------
Add after line 240 (before existing script):
  <script src="config.js"></script>

Change line 242 from:
  const API_URL = process.env.API_URL || 'http://localhost:3001';

To:
  const API_URL = window.APP_CONFIG?.API_URL || 'http://localhost:3001';


FILE 3: electron-app/text-overlay.html
---------------------------------------
Add after line 144 (in head section):
  <script src="config.js"></script>

Change line 146 from:
  const WS_URL = process.env.WS_URL || 'http://localhost:3001';

To:
  const WS_URL = window.APP_CONFIG?.WS_URL || 'http://localhost:3001';


FILE 4: electron-app/image-overlay.html
----------------------------------------
Add in head section (around line 131):
  <script src="config.js"></script>

Change line 133 from:
  const WS_URL = process.env.WS_URL || 'http://localhost:3001';

To:
  const WS_URL = window.APP_CONFIG?.WS_URL || 'http://localhost:3001';


FILE 5: electron-app/code-overlay.html
---------------------------------------
Add after line 164 (before script with WS_URL):
  <script src="config.js"></script>

Change line 166 from:
  const WS_URL = 'http://localhost:3001';

To:
  const WS_URL = window.APP_CONFIG?.WS_URL || 'http://localhost:3001';

ALSO change line 5 (CSP meta tag) from:
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdnjs.cloudflare.com https://cdn.socket.io http://localhost:3001; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.socket.io; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; connect-src http://localhost:3001 ws://localhost:3001">

To:
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://cdnjs.cloudflare.com https://cdn.socket.io http://localhost:3001 https://*.onrender.com; script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com https://cdn.socket.io; style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; connect-src http://localhost:3001 ws://localhost:3001 https://*.onrender.com wss://*.onrender.com">

(Replace *.onrender.com with your actual backend domain if different)

================================================================================
IMPORTANT NOTES:
================================================================================

1. You MUST know your production backend URL first!
   - Where did you deploy your backend? (Render, Heroku, etc.)
   - What's the full URL?

2. If your backend uses HTTPS (which it should), make sure:
   - config.js uses https:// not http://
   - WebSocket URLs use wss:// not ws://

3. After making these changes, rebuild your Electron app:
   npm run build (or whatever your build command is)

4. The CSP change is CRITICAL - without it, even correct URLs will be blocked

5. For development, the fallback to localhost:3001 will still work

================================================================================
QUESTIONS TO ANSWER:
================================================================================

Before editing, I need to know:
1. What is your production backend URL?
2. Is it HTTPS or HTTP?
3. Are you using Render, Heroku, Railway, or something else?

Let me know these details and I can either:
- Make the edits for you with the correct URLs
- Guide you through making them yourself

================================================================================
